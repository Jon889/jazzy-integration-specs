<!DOCTYPE html>
<html lang="en">
  <head>
    <title>EntityCache Protocol Reference</title>
    <link rel="stylesheet" type="text/css" href="../css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="../css/highlight.css" />
    <meta charset='utf-8'>
    <script src="../js/jquery.min.js" defer></script>
    <script src="../js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a name="//apple_ref/swift/Protocol/EntityCache" class="dashAnchor"></a>
    <a title="EntityCache Protocol Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="../index.html">Siesta Docs</a> (96% documented)</p>
        <p class="header-right"><a href="https://github.com/bustoutsolutions/siesta"><img src="../img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="../index.html">Siesta Reference</a>
        <img id="carat" src="../img/carat.png" />
        EntityCache Protocol Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="../Resources.html">Resources</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Classes/Service.html">Service</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/Resource.html">Resource</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/Entity.html">Entity</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/Error.html">Error</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/Configuration.html">Configuration</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/ConfigurationPatternConvertible.html">ConfigurationPatternConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/TypedContentAccessors.html">TypedContentAccessors</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Observering Resources.html">Observering Resources</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/ResourceObserver.html">ResourceObserver</a>
              </li>
              <li class="nav-group-task">
                <a href="../Observering Resources.html#/s:6Siesta23ResourceObserverClosure">ResourceObserverClosure</a>
              </li>
              <li class="nav-group-task">
                <a href="../Enums/ResourceEvent.html">ResourceEvent</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Requests.html">Requests</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/Request.html">Request</a>
              </li>
              <li class="nav-group-task">
                <a href="../Enums/RequestMethod.html">RequestMethod</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Response Parsing.html">Response Parsing</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Enums/Response.html">Response</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/ResponseTransformer.html">ResponseTransformer</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/TransformerSequence.html">TransformerSequence</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/ResponseContentTransformer.html">ResponseContentTransformer</a>
              </li>
              <li class="nav-group-task">
                <a href="../Response Parsing.html#/s:F6Siesta23JSONResponseTransformerFTSb_PS_19ResponseTransformer_">JSONResponseTransformer(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="../Response Parsing.html#/s:F6Siesta23TextResponseTransformerFTSb_PS_19ResponseTransformer_">TextResponseTransformer(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="../Response Parsing.html#/s:F6Siesta24ImageResponseTransformerFTSb_PS_19ResponseTransformer_">ImageResponseTransformer(_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../UI Helpers.html">UI Helpers</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Classes/ResourceStatusOverlay.html">ResourceStatusOverlay</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/RemoteImageView.html">RemoteImageView</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Network Layer.html">Network Layer</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/NetworkingProvider.html">NetworkingProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/NetworkingProviderConvertible.html">NetworkingProviderConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/RequestNetworking.html">RequestNetworking</a>
              </li>
              <li class="nav-group-task">
                <a href="../Network Layer.html#/s:6Siesta35RequestNetworkingCompletionCallback">RequestNetworkingCompletionCallback</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/RequestTransferMetrics.html">RequestTransferMetrics</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/NSURLSessionProvider.html">NSURLSessionProvider</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Caching.html">Caching</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/EntityCache.html">EntityCache</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/EntityEncoder.html">EntityEncoder</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/JSONEntityEncoder.html">JSONEntityEncoder</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Logging.html">Logging</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Logging.html#/s:v6Siesta20enabledLogCategoriesGVSs3SetOS_11LogCategory_">enabledLogCategories</a>
              </li>
              <li class="nav-group-task">
                <a href="../Enums/LogCategory.html">LogCategory</a>
              </li>
              <li class="nav-group-task">
                <a href="../Logging.html#/s:v6Siesta6loggerFTOS_11LogCategorySS_T_">logger</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Other Extensions.html">Other Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Extensions/NSURLSession.html">NSURLSession</a>
              </li>
              <li class="nav-group-task">
                <a href="../Extensions/NSURLSessionConfiguration.html">NSURLSessionConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="../Extensions/String.html">String</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Other Protocols.html">Other Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Other Protocols.html#/s:P6Siesta17NSJSONConvertible">NSJSONConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/SessionTaskContainer.html">SessionTaskContainer</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            <h1>EntityCache</h1>
              <div class="declaration">
                <div class="language">
                  <pre class="highlight"><code><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">EntityCache</span></code></pre>

                </div>
              </div>
            <p>A strategy for saving entities between runs of the app. Allows apps to:</p>

<ul>
<li>launch with the UI in a valid and populated (though possibly stale) state,</li>
<li>recover from low memory situations with fewer reissued network requests, and</li>
<li>work offline.</li>
</ul>

<p>Siesta uses any HTTP request caching provided by the networking layer (e.g. <code>NSURLCache</code>). Why another type of
caching, then? Because <code>NSURLCache</code> has a subtle but significant mismatch with the use cases above:</p>

<ul>
<li>The purpose of HTTP caching is to <em>prevent</em> network requests, but what we need is a way to show old data <em>while
issuing new requests</em>. This is the real deal-killer.</li>
</ul>

<p>Additionally, but less crucially:</p>

<ul>
<li>HTTP caching is <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html">complex</a>, and was designed around a set of
goals relating to static assets and shared proxy caches — goals that look very different from reinflating Siesta
resources’ in-memory state. It’s difficult to guarantee that <code>NSURLCache</code> interacting with the HTTP spec will
exhibit the behavior we want; the logic involved is far more tangled and brittle than implementing a separate cache.</li>
<li>Precisely because of the complexity of these rules, APIs frequently disable all caching via headers.</li>
<li>HTTP caching does not preserve Siesta’s timestamps, which thwarts the staleness logic.</li>
<li>HTTP caching stores raw responses; storing parsed responses offers the opportunity for faster app launch.</li>
</ul>

<p>Siesta currently does not include any implementations of <code>EntityCache</code>, but a future version will.</p>

<div class="aside aside-warning">
    <p class="aside-title">Warning</p>
    <p>Siesta calls <code>EntityCache</code> methods on a GCD background queue, so your implementation <strong>must be
       thread-safe</strong>.</p>

</div>

<div class="aside aside-see-also">
    <p class="aside-title">See also</p>
    <p><code><a href="../Structs/Configuration.html#/s:vV6Siesta13Configuration15persistentCacheGSqPS_11EntityCache__">Configuration.persistentCache</a></code></p>

</div>

          </section>
          <section class="section task-group-section">
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:FP6Siesta11EntityCache10readEntityuRq_S0__Fq_FT6forKeySS_GSqVS_6Entity_"></a>
                    <a name="//apple_ref/swift/Method/readEntity(forKey:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:FP6Siesta11EntityCache10readEntityuRq_S0__Fq_FT6forKeySS_GSqVS_6Entity_">readEntity(forKey:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Return the entity associated with the given key, or nil if it is not in the cache.</p>

<p>If this method returns an entity, it does <em>not</em> pass through the transformer pipeline. Implementations should
return the entity as if already fully parsed and transformed — with the same type of <code>entity.content</code> that was
originally sent to <code><a href="../Protocols/EntityCache.html#/s:FP6Siesta11EntityCache11writeEntityuRq_S0__Fq_FTVS_6Entity6forKeySS_T_">writeEntity(...)</a></code>.</p>

<div class="aside aside-warning">
    <p class="aside-title">Warning</p>
    This method may be called on a background thread. Make sure your implementation is threadsafe.

</div>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight"><code><span class="kd">func</span> <span class="nf">readEntity</span><span class="p">(</span><span class="n">forKey</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Entity</span><span class="p">?</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:FP6Siesta11EntityCache11writeEntityuRq_S0__Fq_FTVS_6Entity6forKeySS_T_"></a>
                    <a name="//apple_ref/swift/Method/writeEntity(_:forKey:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:FP6Siesta11EntityCache11writeEntityuRq_S0__Fq_FTVS_6Entity6forKeySS_T_">writeEntity(_:forKey:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Store the given entity in the cache, associated with the given key. The key’s format is arbitrary, and internal
to Siesta. (OK, it’s just the resource’s URL, but you should pretend you don’t know that in your implementation.
Cache implementations should treat the <code>forKey</code> parameter as an opaque value.)</p>

<p>This method receives entities <em>after</em> they have been through the transformer pipeline. The <code>entity.content</code> will
be a parsed object, not raw data.</p>

<p>Implementations are under no obligation to actually perform the write. This method can — and should — examine the
type of the entity’s <code>content</code> and/or its header values, and ignore it if it is not encodable.</p>

<p>Note that this method does not receive a URL as input; if you need to limit caching to specific resources, use
Siesta’s configuration mechanism to control which resources are cacheable.</p>

<div class="aside aside-warning">
    <p class="aside-title">Warning</p>
    The method may be called on a background thread. Make sure your implementation is threadsafe.

</div>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight"><code><span class="kd">func</span> <span class="nf">writeEntity</span><span class="p">(</span><span class="nv">entity</span><span class="p">:</span> <span class="kt">Entity</span><span class="p">,</span> <span class="n">forKey</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </section>
        </section>
        <section id="footer">
          <p>© 2016 <a class="link" href="http://bustoutsolutions.com" target="_blank" rel="external">Bust Out Solutions</a> under <a class="link" href="https://github.com/bustoutsolutions/siesta/blob/master/LICENSE" target="_blank" rel="external">open source license</a>.</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ vX.X.X</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
